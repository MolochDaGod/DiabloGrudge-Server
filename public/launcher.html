<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DiabloGrudge ZeroTier Launcher</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0505 100%);
            font-family: 'Arial', sans-serif;
            color: #d4af37;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        h1 {
            font-size: 2.5em;
            text-shadow: 0 0 20px #d4af37, 0 0 40px #8b0000;
            margin: 20px 0;
            letter-spacing: 3px;
            text-align: center;
        }

        .subtitle {
            font-size: 14px;
            color: #8b7355;
            margin-bottom: 30px;
            text-align: center;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .panel {
            background: rgba(26, 26, 26, 0.95);
            border: 2px solid #d4af37;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.3);
        }

        .panel-title {
            font-size: 20px;
            color: #d4af37;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
            border-bottom: 2px solid #d4af37;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff0000;
            animation: pulse 2s infinite;
        }

        .status-indicator.connected {
            background: #00ff00;
        }

        .status-indicator.warning {
            background: #ffa500;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 15px;
            margin: 8px 0;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 5px;
            border-left: 3px solid #d4af37;
        }

        .info-label {
            color: #8b7355;
            font-size: 12px;
            text-transform: uppercase;
        }

        .info-value {
            color: #d4af37;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        .info-value.success {
            color: #00ff00;
        }

        .info-value.error {
            color: #ff0000;
        }

        .game-card {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d1a1a 100%);
            border: 2px solid #d4af37;
            border-radius: 8px;
            padding: 20px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .game-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 25px rgba(212, 175, 55, 0.5);
            border-color: #ffd700;
        }

        .game-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.2), transparent);
            transition: left 0.5s;
        }

        .game-card:hover::before {
            left: 100%;
        }

        .game-icon {
            font-size: 3em;
            text-align: center;
            margin-bottom: 10px;
        }

        .game-name {
            font-size: 18px;
            font-weight: bold;
            color: #d4af37;
            text-align: center;
            margin-bottom: 8px;
        }

        .game-version {
            font-size: 11px;
            color: #8b7355;
            text-align: center;
            margin-bottom: 15px;
        }

        .btn {
            background: #8b0000;
            color: #d4af37;
            border: 2px solid #d4af37;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            width: 100%;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover:not(:disabled) {
            background: #d4af37;
            color: #000;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.6);
            transform: scale(1.02);
        }

        .btn:disabled {
            background: #4a4a4a;
            color: #8b7355;
            border-color: #8b7355;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .btn-secondary {
            background: #1a1a1a;
            margin-top: 8px;
        }

        .alert {
            background: rgba(255, 0, 0, 0.2);
            border: 2px solid #ff0000;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            color: #ff6666;
            font-size: 13px;
        }

        .alert.success {
            background: rgba(0, 255, 0, 0.2);
            border-color: #00ff00;
            color: #66ff66;
        }

        .alert.info {
            background: rgba(212, 175, 55, 0.2);
            border-color: #d4af37;
            color: #d4af37;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .copy-btn {
            background: none;
            border: 1px solid #d4af37;
            color: #d4af37;
            padding: 4px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 10px;
            margin-left: 10px;
            transition: all 0.2s;
        }

        .copy-btn:hover {
            background: #d4af37;
            color: #000;
        }

        .instructions {
            background: rgba(0, 0, 0, 0.6);
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            font-size: 13px;
            line-height: 1.6;
        }

        .instructions ol {
            margin-left: 20px;
        }

        .instructions li {
            margin: 8px 0;
            color: #d4af37;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #8b7355;
            font-style: italic;
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <h1>‚öîÔ∏è DiabloGrudge ZeroTier Launcher ‚öîÔ∏è</h1>
    <div class="subtitle">Network-Ready Game Deployment System</div>

    <div class="container">
        <!-- ZeroTier Network Status -->
        <div class="panel">
            <div class="panel-title">
                <div class="status-indicator" id="ztStatus"></div>
                ZeroTier Network Status
            </div>
            
            <div id="networkInfo">
                <div class="loading">üîÑ Checking ZeroTier connection...</div>
            </div>

            <div class="info-row">
                <span class="info-label">Network ID</span>
                <span class="info-value">cf719fd5401e3d2c</span>
                <button class="copy-btn" onclick="copyToClipboard('cf719fd5401e3d2c')">Copy</button>
            </div>

            <div class="alert info" style="margin-top: 20px;">
                <strong>üì° Network Dashboard:</strong><br>
                <a href="https://my.zerotier.com/" target="_blank" style="color: #d4af37;">my.zerotier.com</a>
            </div>
        </div>

        <!-- Available Games -->
        <div class="panel">
            <div class="panel-title">
                üéÆ Available Games
            </div>

            <div class="game-card" onclick="launchGame('thoc')">
                <div class="game-icon">üî•</div>
                <div class="game-name">The Hordes of Chaos</div>
                <div class="game-version">THOC Beta 8.1 (v1.10)</div>
                <button class="btn" id="btnThoc">Launch THOC</button>
                <button class="btn btn-secondary" onclick="event.stopPropagation(); hostGame('thoc')">
                    Host TCP/IP Game
                </button>
            </div>

            <div class="game-card" onclick="openLobby()">
                <div class="game-icon">üåê</div>
                <div class="game-name">Web Lobby</div>
                <div class="game-version">DiabloGrudge Browser Interface</div>
                <button class="btn">Open Lobby</button>
            </div>
        </div>

        <!-- Hosting Instructions -->
        <div class="panel full-width">
            <div class="panel-title">
                üìã How to Host & Join Games
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="instructions">
                    <strong style="color: #d4af37;">üéÆ Host a Game:</strong>
                    <ol>
                        <li>Click "Launch THOC" above</li>
                        <li>In D2: Multiplayer ‚Üí TCP/IP ‚Üí Host Game</li>
                        <li>Share your ZeroTier IP (shown above)</li>
                        <li>Friends join using your IP</li>
                    </ol>
                </div>

                <div class="instructions">
                    <strong style="color: #d4af37;">üë• Join a Game:</strong>
                    <ol>
                        <li>Install ZeroTier from <a href="https://www.zerotier.com/download/" target="_blank" style="color: #ffd700;">zerotier.com</a></li>
                        <li>Join network: <strong>cf719fd5401e3d2c</strong></li>
                        <li>Get authorized by host</li>
                        <li>Launch D2 ‚Üí TCP/IP ‚Üí Join ‚Üí Enter host IP</li>
                    </ol>
                </div>
            </div>

            <div class="alert success" id="hostAlert" style="display: none;">
                ‚úÖ Ready to host! Share your IP: <strong id="shareIP"></strong>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const config = {
            zerotierNetworkId: 'cf719fd5401e3d2c',
            cactusPath: 'C:\\Users\\nugye\\Documents\\Cactus\\Cactus\\thoc_b8_1',
            serverUrl: window.location.origin,
            checkInterval: 5000
        };

        // Check ZeroTier status
        async function checkZeroTierStatus() {
            try {
                const response = await fetch('/api/zerotier/status');
                const data = await response.json();
                
                updateNetworkUI(data);
            } catch (error) {
                console.error('Failed to check ZeroTier:', error);
                updateNetworkUI({ connected: false, error: error.message });
            }
        }

        // Update Network UI
        function updateNetworkUI(data) {
            const statusIndicator = document.getElementById('ztStatus');
            const networkInfo = document.getElementById('networkInfo');
            const hostAlert = document.getElementById('hostAlert');
            const shareIP = document.getElementById('shareIP');

            if (data.connected && data.ip && !data.ip.startsWith('169.254')) {
                // Fully connected
                statusIndicator.className = 'status-indicator connected';
                networkInfo.innerHTML = `
                    <div class="info-row">
                        <span class="info-label">Status</span>
                        <span class="info-value success">‚úÖ Connected</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Your IP</span>
                        <span class="info-value success">${data.ip}</span>
                        <button class="copy-btn" onclick="copyToClipboard('${data.ip}')">Copy</button>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Online Since</span>
                        <span class="info-value">${data.uptime || 'Unknown'}</span>
                    </div>
                `;
                
                hostAlert.style.display = 'block';
                shareIP.textContent = data.ip;
            } else if (data.connected && data.ip && data.ip.startsWith('169.254')) {
                // Not authorized
                statusIndicator.className = 'status-indicator warning';
                networkInfo.innerHTML = `
                    <div class="info-row">
                        <span class="info-label">Status</span>
                        <span class="info-value" style="color: #ffa500;">‚ö†Ô∏è Not Authorized</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Current IP</span>
                        <span class="info-value error">${data.ip}</span>
                    </div>
                    <div class="alert">
                        <strong>‚ö†Ô∏è Authorization Required</strong><br>
                        Go to <a href="https://my.zerotier.com/" target="_blank" style="color: #ffd700;">my.zerotier.com</a> and authorize this device.
                    </div>
                `;
                hostAlert.style.display = 'none';
            } else {
                // Disconnected
                statusIndicator.className = 'status-indicator';
                networkInfo.innerHTML = `
                    <div class="info-row">
                        <span class="info-label">Status</span>
                        <span class="info-value error">‚ùå Disconnected</span>
                    </div>
                    <div class="alert">
                        <strong>‚ùå ZeroTier Not Connected</strong><br>
                        ${data.error || 'Make sure ZeroTier is running and joined to the network.'}
                    </div>
                `;
                hostAlert.style.display = 'none';
            }
        }

        // Copy to clipboard
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('‚úÖ Copied: ' + text);
            }).catch(err => {
                console.error('Copy failed:', err);
            });
        }

        // Show notification
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: rgba(0, 255, 0, 0.2);
                border: 2px solid #00ff00;
                color: #00ff00;
                padding: 15px 25px;
                border-radius: 5px;
                z-index: 9999;
                animation: slideIn 0.3s;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Launch game
        async function launchGame(gameId) {
            try {
                showNotification('üöÄ Launching game...');
                
                const response = await fetch('/api/launch-game', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        game: gameId,
                        path: config.cactusPath
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    showNotification('‚úÖ ' + result.message);
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error('Launch failed:', error);
                showNotification('‚ùå Failed to launch: ' + error.message);
                
                // Fallback: open Cactus directory
                window.open('file:///' + config.cactusPath.replace(/\\/g, '/'));
            }
        }

        // Host game (convenience function)
        async function hostGame(gameId) {
            await launchGame(gameId);
            setTimeout(() => {
                showNotification('üí° In D2: Multiplayer ‚Üí TCP/IP ‚Üí Host Game');
            }, 2000);
        }

        // Open web lobby
        function openLobby() {
            window.open('/', '_blank');
        }

        // Initialize
        checkZeroTierStatus();
        setInterval(checkZeroTierStatus, config.checkInterval);

        // Add CSS animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(400px); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
